<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="techstyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <title>Doc Doctor</title>
  <script language="javascript" type="text/javascript" src="script.js"></script>
  <style>
    /* Add a new style block for additional styling */
    .form-container {
      max-width: 400px;
      margin: 0 auto;
    }

    form {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 16px;
      box-sizing: border-box;
    }

    /* Adjust responsiveness for smaller screens */
    @media screen and (max-width: 600px) {
      .form-container {
        width: 80%;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <h1>Your Tech Website</h1>
    </div>
  </header>

  <nav>
    <div class="container">
      <a href="index.html" class="nav-link">Home</a>
      <a href="#" class="nav-link">About</a>
      <a href="#" class="nav-link">Services</a>
      <a href="#" class="nav-link">Contact</a>
    </div>
  </nav>

  <div class="container main-content">
    <h2>Welcome to Your Tech Website</h2>
    <p>This is a sample text for your main content. You can provide information about your tech-related services, products, or any other relevant content here.</p>

    <!-- Form for Text ID with POST action -->
    <div class="form-container">
      <form id="textIdForm">
        <label for="text_id">Text ID:</label>
        <input type="text" id="text_id" name="text_id" placeholder="Enter Text ID" required>
        <button type="submit">Submit Text ID</button>
      </form>
    </div>

    <!-- Form for Search with GET action -->
    <div class="form-container">
      <form id="searchForm">
        <label for="search">Enter query:</label>
        <input type="text" id="search" name="search" placeholder="Search query" required>
        <button type="submit">Search</button>
      </form>
    </div>

    <!-- Response container -->
    <div id="responseContainer"></div>

  </div>

  <footer>
    <div class="container">
      <p>&copy; 2024 Doctor Your doc assistant. All rights reserved.</p>
      <div id="bearer">
        <script type="text/javascript">
          var bearer = localStorage.getItem('bearer');
          bearercontainer = document.getElementById('bearer');
          if (bearer === null || bearer.length == 0) {
            bearercontainer.textContent = "Bearer - Not set";
            bearercontainer.innerHTML += "<form id='bearerform'><input type = 'text' id='newbearer'></form>";
          }
          else {
            bearercontainer.textContent = "Bearer is set " ;          
          }
       </script>
      </div>
    </div>
  </footer>
  <script>
    document.getElementById('bearerform').addEventListener('submit', function (event) {
      event.preventDefault();
      const bearerid = document.getElementById('newbearer').value;
      console.log("new bearer "+ bearerid);
      localStorage.setItem('bearer',bearerid);
      
    });
  </script>
            
  </script>
  <!-- Include JavaScript -->
  <script>
    // Function to handle the Text ID form submission (POST request)
    document.getElementById('textIdForm').addEventListener('submit', function (event) {
      event.preventDefault();

      const textId = document.getElementById('text_id').value;

      const apiUrl = `http://127.0.0.1:8012/v1.0/text/${encodeURIComponent(textId)}`;
      //localStorage.setItem('bearer', "");
      var bearer = localStorage.getItem('bearer');
      console.log("bearer "+ bearer)
      const requestData = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer '+bearer,
        },
        //body: JSON.stringify({
        //  text_id: textId,
        //}),
      };

      fetch(apiUrl, requestData)
        .then(response => response.json())
        .then(data => {
          displayResponse(data);
        })
        .catch(error => {
          displayResponse({ error: 'Failed to fetch data' });
          console.error('GET Error:', error);
        });
    });

    // Function to handle the Search form submission (GET request)
    document.getElementById('searchForm').addEventListener('submit', function (event) {
      event.preventDefault();

      const searchText = document.getElementById('search').value;

      const apiUrl = `http://127.0.0.1:8012/v1.0/text?text_id=${encodeURIComponent(searchText)}`; // Replace with your API endpoint
      const requestData = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer '+bearer,
        },
      };

      fetch(apiUrl, requestData)
        .then(response => response.json())
        .then(data => {
          displayResponse(data);
        })
        .catch(error => {
          displayResponse({ error: 'Failed to fetch data' });
          console.error('GET Error:', error);
        });
    });

    // Function to display the API response
    function displayResponse(data) {
      const responseContainer = document.getElementById('responseContainer');
      if (data && data.text) {
        const responseValue = data.text;
        responseContainer.textContent = responseValue;
      } else {
        responseContainer.textContent = 'Invalid or missing response data';
        }
      //responseContainer.innerHTML = JSON.stringify(data, null, 2);
      responseContainer.style.display = 'block'; // Show the response container
    }
  </script>
</body>
</html>
